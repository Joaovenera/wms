# Virtual Host Configuration for wms.jarmaq.com.br
# Place this file in /usr/local/lsws/conf/vhosts/wms.conf

virtualhost wms.jarmaq.com.br {
  # Document Root
  docRoot                   /home/claude-user/wms/frontend/dist
  
  # Enable Gzip
  enableGzip                1
  
  # Index Files
  index  {
    useServer               0
    indexFiles              index.html
  }
  
  # Rewrite Rules for SPA
  rewrite  {
    enable                  1
    rules                   <<<END_rules
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.html [L]
END_rules
  }
  
  # Proxy Configuration for Backend API
  context /api {
    type                    proxy
    handler                 http://127.0.0.1:3000
    addDefaultCharset       off
  }
  
  # Security Headers
  headers  {
    header                  <<<END_headers
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:; frame-ancestors 'none';
END_headers
  }
  
  # SSL Configuration (if using HTTPS)
  ssl  {
    keyFile                 /usr/local/lsws/ssl/wms.jarmaq.com.br.key
    certFile                /usr/local/lsws/ssl/wms.jarmaq.com.br.crt
    certChain               1
    certChainFile           /usr/local/lsws/ssl/wms.jarmaq.com.br.chain.crt
  }
  
  # Access Control
  accesslog                 /usr/local/lsws/logs/wms.jarmaq.com.br.access.log
  errorlog                  /usr/local/lsws/logs/wms.jarmaq.com.br.error.log
  
  # Performance
  maxKeepAliveReq          10000
  smartKeepAlive           1
  keepAliveTimeout         5
  maxConnections           10000
}
